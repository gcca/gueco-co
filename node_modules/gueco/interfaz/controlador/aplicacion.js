/*! gueco.interfaz.controlador
 */

aplicacion.prototype.peticion_es_autorizada =
    function(peticion, respuesta, siguiente) {

    var tarugos;

    if (tarugos = peticion.headers.authorization) {
        tarugos = new Buffer(tarugos.split(/\s+/).pop(),
                             'base64').toString().split(/:/)

        this.fachada_servicio_usuario.autenticar(
            tarugos[0], tarugos[1], function(error, usuario) {

            if (usuario) {
                peticion.usuario = usuario
                siguiente()
            } else {
                respuesta.setHeader('WWW-Authenticate',
                                    'Basic realm=""')
                respuesta.writeHead(401)
                respuesta.end()
            }
        })
    } else {
        respuesta.setHeader('WWW-Authenticate',
                            'Basic realm=""')
        respuesta.writeHead(401)
        respuesta.end()
    }
}

function aplicacion () {}

module.exports = aplicacion
